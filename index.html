<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MindClear</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="MindClear">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Helvetica Neue", Arial, sans-serif;
            background-color: #F2F2F7;
            -webkit-tap-highlight-color: transparent;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .card-enter {
            animation: slideUp 0.3s cubic-bezier(0.16, 1, 0.3, 1);
        }

        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        /* Removed fixed color from .tab-active 
           Colors are now handled dynamically via utility classes in JS 
        */
        .tab-active {
            font-weight: 600; /* Optional: make active tab slightly bolder */
        }
        .tab-inactive {
            color: #9CA3AF; /* gray-400 */
        }

        /* Hide Scrollbar */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        .safe-bottom {
            padding-bottom: env(safe-area-inset-bottom, 20px);
        }
    </style>
</head>
<body class="bg-gray-100">

    <!-- Header -->
    <header class="bg-white/80 backdrop-blur-md sticky top-0 z-20 border-b border-gray-200 pt-12 pb-3 px-4 relative flex justify-center items-end">
        <div class="text-center">
            <h1 class="text-[25px] font-bold text-gray-900" id="headerTitle">待办清单</h1>
            <p class="text-[10px] text-gray-500 mt-0.5" id="headerSubtitle">大脑用来思考，系统用来记录</p>
        </div>
        <div class="absolute right-4 bottom-3.5 text-xs text-gray-400 font-medium" id="itemCount">0 条记录</div>
    </header>

    <!-- Main List Container -->
    <main id="mainContainer" class="flex-1 overflow-y-auto no-scrollbar p-4 space-y-3 pb-32">
        <!-- Content injected here -->
    </main>

    <!-- Empty State Removed -->

    <!-- Add Button (FAB) - Changed to Red Theme -->
    <button onclick="openModal()" class="fixed bottom-24 right-6 bg-red-500 hover:bg-red-600 text-white w-14 h-14 rounded-full shadow-lg shadow-red-500/30 flex items-center justify-center text-2xl z-20 transition-transform active:scale-90">
        <i class="fas fa-plus"></i>
    </button>

    <!-- Bottom Tab Bar -->
    <nav class="fixed bottom-0 w-full bg-white border-t border-gray-200 flex justify-around items-center safe-bottom z-20 text-xs font-medium">
        <button onclick="switchTab('todos')" class="flex-1 py-3 flex flex-col items-center gap-1 transition-colors duration-200" id="tab-todos">
            <i class="fas fa-check-circle text-xl"></i>
            <span>待办</span>
        </button>
        <button onclick="switchTab('ideas')" class="flex-1 py-3 flex flex-col items-center gap-1 transition-colors duration-200" id="tab-ideas">
            <i class="fas fa-lightbulb text-xl"></i>
            <span>念头</span>
        </button>
    </nav>

    <!-- Input Modal -->
    <div id="inputModal" class="fixed inset-0 bg-black/60 z-50 hidden flex items-start justify-center pt-20 transition-opacity duration-200 opacity-0">
        <div class="bg-white w-full max-w-sm rounded-2xl p-4 shadow-2xl transform translate-y-8 transition-transform duration-300 ease-out mx-4" id="modalPanel">
            <div class="flex justify-between items-center mb-3">
                <span class="text-gray-500 font-medium text-sm">记录新内容</span>
                <button onclick="closeModal()" class="text-gray-400 bg-gray-100 w-8 h-8 rounded-full"><i class="fas fa-times"></i></button>
            </div>
            
            <textarea id="inputContent" rows="3" placeholder="刚才想到了什么？或者有什么任务？" class="w-full bg-gray-50 text-lg p-3 rounded-xl border-none focus:ring-2 focus:ring-blue-500 mb-4 resize-none"></textarea>
            
            <!-- Buttons Swapped: Todo on Left (Red), Idea on Right (Yellow) -->
            <div class="flex gap-3">
                <button onclick="saveItem('todo')" class="flex-1 bg-red-500 text-white py-3 rounded-xl font-semibold flex items-center justify-center gap-2 active:bg-red-600">
                    <i class="fas fa-check"></i> 设为待办
                </button>
                <button onclick="saveItem('idea')" class="flex-1 bg-yellow-100 text-yellow-700 py-3 rounded-xl font-semibold flex items-center justify-center gap-2 active:bg-yellow-200">
                    <i class="fas fa-lightbulb"></i> 收入念头
                </button>
            </div>
        </div>
    </div>

    <!-- Custom Alert/Confirm Modal -->
    <div id="alertModal" class="fixed inset-0 bg-black/40 z-[60] hidden flex items-center justify-center transition-opacity duration-300 opacity-0">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-xs mx-4 p-6 text-center transform scale-90 transition-transform duration-300">
            <h3 id="alertTitle" class="text-lg font-semibold text-gray-900 mb-3"></h3>
            <p id="alertMessage" class="text-sm text-gray-600 mb-6"></p>
            <div id="alertButtons" class="flex gap-3">
                <!-- Buttons injected here -->
            </div>
        </div>
    </div>

    <script>
        // Data Structure
        // Item: { id, text, type: 'idea'|'todo', created, completed: boolean }
        let items = JSON.parse(localStorage.getItem('mindclear_items')) || [];
        
        let currentTab = 'todos'; 

        // Initialize Tab based on content
        const todoCount = items.filter(i => i.type === 'todo').length;
        const ideaCount = items.filter(i => i.type === 'idea').length;
        if (todoCount === 0 && ideaCount > 0) {
            currentTab = 'ideas';
        }

        // DOM Elements
        const mainContainer = document.getElementById('mainContainer');
        // Removed emptyState element reference
        const inputModal = document.getElementById('inputModal');
        const modalPanel = document.getElementById('modalPanel');
        const inputContent = document.getElementById('inputContent');
        const headerTitle = document.getElementById('headerTitle');
        const itemCount = document.getElementById('itemCount');
        
        // Custom Alert Elements
        const alertModal = document.getElementById('alertModal');
        const alertTitle = document.getElementById('alertTitle');
        const alertMessage = document.getElementById('alertMessage');
        const alertButtons = document.getElementById('alertButtons');

        // Initial Render
        switchTab(currentTab);

        // --- Core Functions ---

        function switchTab(tab) {
            currentTab = tab;
            
            const todoBtn = document.getElementById('tab-todos');
            const ideaBtn = document.getElementById('tab-ideas');

            // Reset base classes
            todoBtn.className = "flex-1 py-3 flex flex-col items-center gap-1 transition-colors duration-200";
            ideaBtn.className = "flex-1 py-3 flex flex-col items-center gap-1 transition-colors duration-200";

            if (tab === 'todos') {
                // Todos Active: Red
                todoBtn.classList.add('text-red-500', 'tab-active');
                ideaBtn.classList.add('text-gray-400', 'tab-inactive');
                
                headerTitle.innerText = "待办清单";
            } else {
                // Ideas Active: Yellow
                todoBtn.classList.add('text-gray-400', 'tab-inactive');
                ideaBtn.classList.add('text-yellow-600', 'tab-active');
                
                headerTitle.innerText = "念头";
            }

            render();
        }

        function render() {
            mainContainer.innerHTML = '';
            
            const filteredItems = items
                .filter(item => item.type === (currentTab === 'ideas' ? 'idea' : 'todo'))
                .sort((a, b) => b.created - a.created);

            itemCount.innerText = `${filteredItems.length} 条`;

            // Simplified render logic: no empty state to toggle
            filteredItems.forEach(item => {
                mainContainer.appendChild(createItemElement(item));
            });
        }

        function createItemElement(item) {
            const div = document.createElement('div');
            div.className = `bg-white p-4 rounded-xl shadow-sm flex items-start gap-3 card-enter ${item.completed ? 'opacity-50' : ''}`;
            
            const date = new Date(item.created);
            const timeStr = `${date.getMonth()+1}/${date.getDate()} ${String(date.getHours()).padStart(2, '0')}:${String(date.getMinutes()).padStart(2, '0')}`;

            let actionBtn = '';
            let mainIcon = '';

            // Icon logic
            if (item.type === 'idea') {
                mainIcon = `<div class="mt-1 text-yellow-500 text-lg w-6 text-center"><i class="fas fa-lightbulb"></i></div>`;
                
                // Convert to Todo (Now Red Theme)
                actionBtn = `
                    <button onclick="convertToTodo(${item.id})" class="text-xs bg-red-50 text-red-600 px-3 py-1.5 rounded-lg font-medium ml-auto transition-colors active:scale-[0.98]">
                        转为待办
                    </button>
                `;
            } else {
                // Checkbox (Now Red Theme)
                const checkIcon = item.completed ? 'fa-check-square text-red-500' : 'fa-square text-gray-300';
                mainIcon = `<button onclick="toggleTodo(${item.id})" class="mt-1 text-2xl transition-colors active:scale-95"><i class="far ${checkIcon}"></i></button>`;

                actionBtn = `
                    <button onclick="convertToIdea(${item.id})" class="text-xs bg-yellow-50 text-yellow-600 px-3 py-1.5 rounded-lg font-medium ml-auto transition-colors active:scale-[0.98]">
                        转为念头
                    </button>
                `;
            }

            div.innerHTML = `
                ${mainIcon}
                <div class="flex-1 min-w-0">
                    <div class="flex items-start justify-between">
                        <p class="text-gray-800 text-base leading-relaxed break-words ${item.completed ? 'line-through text-gray-400' : ''}">
                            ${item.text}
                        </p>
                    </div>
                    <div class="flex items-center justify-between mt-2">
                        <div class="flex items-center">
                            <span class="text-xs text-gray-400">${timeStr}</span>
                        </div>
                        <div class="flex items-center gap-2">
                            ${actionBtn}
                            <button onclick="deleteItem(${item.id})" class="text-gray-300 hover:text-red-500 p-2 -mr-2 transition-colors active:scale-95">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `;
            return div;
        }

        // --- Data Logic ---

        function saveItem(type) {
            const text = inputContent.value.trim();
            if (!text) return;

            const newItem = {
                id: Date.now(),
                text: text,
                type: type, 
                created: Date.now(),
                completed: false
            };

            items.unshift(newItem);
            localStorage.setItem('mindclear_items', JSON.stringify(items));
            
            closeModal();
            
            if (currentTab !== 'ideas' && type === 'idea') switchTab('ideas');
            else if (currentTab !== 'todos' && type === 'todo') switchTab('todos');
            else render();
        }

        async function deleteItem(id) {
            const confirmed = await customConfirm('确认删除', '是否将此项永久移除？');
            if (confirmed) {
                items = items.filter(i => i.id !== id);
                localStorage.setItem('mindclear_items', JSON.stringify(items));
                render();
            }
        }

        function toggleTodo(id) {
            const item = items.find(i => i.id === id);
            if (item) {
                item.completed = !item.completed;
                localStorage.setItem('mindclear_items', JSON.stringify(items));
                render();
            }
        }

        function convertToTodo(id) {
            const item = items.find(i => i.id === id);
            if (item) {
                item.type = 'todo';
                localStorage.setItem('mindclear_items', JSON.stringify(items));
                switchTab('todos');
            }
        }

        function convertToIdea(id) {
            const item = items.find(i => i.id === id);
            if (item) {
                item.type = 'idea';
                item.completed = false;
                localStorage.setItem('mindclear_items', JSON.stringify(items));
                switchTab('ideas');
            }
        }

        // --- Modal & Alert Logic ---
        
        function customConfirm(title, message, isConfirm = true) {
            return new Promise(resolve => {
                resolveAlertPromise = resolve;
                alertTitle.innerText = title;
                alertMessage.innerText = message;
                alertButtons.innerHTML = ''; 

                const btnClass = "flex-1 py-2 rounded-lg font-medium transition duration-150 active:scale-[0.98]";
                if (isConfirm) {
                    const cancelBtn = document.createElement('button');
                    cancelBtn.innerText = '取消';
                    cancelBtn.className = `${btnClass} bg-gray-100 text-gray-700 hover:bg-gray-200`;
                    cancelBtn.onclick = () => { closeAlert(false); };
                    alertButtons.appendChild(cancelBtn);
                }
                const okBtn = document.createElement('button');
                okBtn.innerText = isConfirm ? '确定' : '好的';
                okBtn.className = `${btnClass} ${isConfirm ? 'bg-red-500 text-white hover:bg-red-600' : 'bg-blue-500 text-white hover:bg-blue-600'}`;
                okBtn.onclick = () => { closeAlert(true); };
                alertButtons.appendChild(okBtn);

                alertModal.classList.remove('hidden');
                void alertModal.offsetWidth;
                alertModal.classList.remove('opacity-0');
                alertModal.querySelector('div').classList.remove('scale-90');
            });
        }

        function closeAlert(result) {
            alertModal.classList.add('opacity-0');
            alertModal.querySelector('div').classList.add('scale-90');
            setTimeout(() => {
                alertModal.classList.add('hidden');
                if (resolveAlertPromise) {
                    resolveAlertPromise(result);
                    resolveAlertPromise = null;
                }
            }, 300);
        }

        function openModal() {
            inputModal.classList.remove('hidden');
            inputContent.focus();
            void inputModal.offsetWidth;
            inputModal.classList.remove('opacity-0');
            modalPanel.classList.remove('translate-y-8');
        }

        function closeModal() {
            inputModal.classList.add('opacity-0');
            modalPanel.classList.add('translate-y-8');
            setTimeout(() => {
                inputModal.classList.add('hidden');
                inputContent.value = '';
                inputContent.blur();
            }, 300);
        }

        inputModal.addEventListener('click', (e) => {
            if (e.target === inputModal) closeModal();
        });
    </script>
</body>
</html>